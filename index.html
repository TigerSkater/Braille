<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Accessible Braille Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f172a;
      --accent: #2dd4bf;
      --accent-soft: rgba(45, 212, 191, 0.16);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --focus: rgba(45, 212, 191, 0.7);
      --radius: 16px;
    }
  

    * {
      box-sizing: border-box;
    }

    body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: radial-gradient(circle at top, #1f2937, #020617);
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 2rem 1rem;
}
    

    main {
      width: 100%;
      max-width: 900px;
      background: var(--panel);
      border-radius: 24px;
      padding: 1.75rem 1.5rem 2rem;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    header {
      margin-bottom: 1.5rem;
    }
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
  }

    .header-bar .tabs {
     margin-top: 0.2rem;
  }
    h1 {
      font-size: 1.6rem;
      margin: 0 0 0.4rem;
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }

    h1 span.logo-dot {
      font-size: 1.7rem;
      letter-spacing: 0.15em;
    }

    p.tagline {
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

 @media (max-width: 800px) {
  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }
}

    .card {
      background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%);
      border-radius: var(--radius);
      padding: 1rem 1rem 1.1rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      resize: vertical;
      padding: 0.75rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #020617;
      color: var(--text);
      font-size: 0.95rem;
      line-height: 1.4;
      transition: box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--focus);
      background: #020617;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
      white-space: nowrap;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.2rem;
    }

    .output-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .output-subtitle {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .output-box {
      min-height: 150px;
      border-radius: 12px;
      padding: 0.75rem;
      background: #020617;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      overflow-x: auto;
    }

    .braille-line {
      margin-bottom: 0.5rem;
      white-space: nowrap;
    }

    .braille-cell {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.7rem;
      margin-right: 0.3rem;
      padding: 0.1rem 0.25rem;
    }

    .braille-cell.space {
      width: 1.2rem;
    }

    .footer-note {
      margin-top: 1.25rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.75rem;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.25);
      border: 1px solid rgba(45, 212, 191, 0.5);
      color: var(--accent);
    }

    .badge-dot {
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 999px;
      background: var(--accent);
    }

    /* =================== ADDED: OVERRIDE FOR NO LETTER SPACING =================== */
    .braille-cell {
      margin-right: 0; /* no extra space between braille characters */
    }

    /* =================== ADDED: TOUCH LETTER KEYBOARD STYLES =================== */
    .braille-keyboard {
      margin-top: 1rem;
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 0.5rem;
      user-select: none;
      touch-action: manipulation;
    }

    .braille-key {
      height: 48px;
      border-radius: 12px;
      border: 1px solid rgba(45, 212, 191, 0.45);
      background: rgba(45, 212, 191, 0.18);
      color: var(--text);
      font-weight: 600;
    }

    .braille-key:active {
      background: rgba(45, 212, 191, 0.45);
      transform: scale(0.97);
    }

    .braille-key.space-key {
      grid-column: 1 / -1;
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
    }
    /* =================== TABS =================== */
.tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.tab-button {
  padding: 0.4rem 0.9rem;
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.4);
  background: transparent;
  color: var(--muted);
  font-size: 0.8rem;
  cursor: pointer;
}

.tab-button[aria-selected="true"] {
  background: rgba(45, 212, 191, 0.18);
  color: var(--accent);
  border-color: rgba(45, 212, 191, 0.6);
}

.tab-panel {
  display: none;
}

.tab-panel[aria-hidden="false"] {
  display: block;
}
/* ===== TRANSLATOR LAYOUT FIX ===== */
.translator-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

/* Stack on small screens */
@media (max-width: 800px) {
  .translator-row {
    grid-template-columns: 1fr;
  }
}

/* Make keyboard wider */
.braille-keyboard {
  grid-template-columns: repeat(10, minmax(0, 1fr));
}

@media (min-width: 900px) {
  .braille-keyboard {
    grid-template-columns: repeat(12, minmax(0, 1fr));
  }
}
    /* Let Translator tab span the full grid width */
#panel-translator {
  grid-column: 1 / -1;
}
/* Hide keyboard ONLY on Info tab */
#panel-info .braille-keyboard {
  display: none;
}
/* Make Info tab use full width */
#panel-info {
  grid-column: 1 / -1;
}

/* Stretch cards inside Info tab */
#panel-info .card {
  width: 100%;
  max-width: 100%;
}
/* Make Personality tab use full width */
#panel-personality {
  grid-column: 1 / -1;
}
/* ===== PERSONALITY REVEAL GLOW ===== */
@keyframes rareGlow {
  0% { box-shadow: 0 0 0 rgba(168, 85, 247, 0.0); }
  50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.8); }
  100% { box-shadow: 0 0 0 rgba(168, 85, 247, 0.0); }
}

@keyframes legendaryGlow {
  0% { box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
  50% { box-shadow: 0 0 35px rgba(250, 204, 21, 0.9); }
  100% { box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
}

@keyframes oracleGlow {
  0% { box-shadow: 0 0 0 rgba(148, 163, 184, 0.0); }
  50% { box-shadow: 0 0 40px rgba(226, 232, 240, 0.95); }
  100% { box-shadow: 0 0 0 rgba(148, 163, 184, 0.0); }
}

.personality-rare {
  animation: rareGlow 1.6s ease-out;
}

.personality-legendary {
  animation: legendaryGlow 2s ease-out;
}

.personality-oracle {
  animation: oracleGlow 2.4s ease-out;
}
/* ===== EASTER EGG: flying 67 ===== */
@keyframes fly67 {
  0% {
    transform: translate(var(--x0), var(--y0)) scale(0.9) rotate(0deg);
    opacity: 0;
  }
  10% { opacity: 1; }
  100% {
    transform: translate(var(--x1), var(--y1)) scale(1.2) rotate(360deg);
    opacity: 0;
  }
}

.flying-67 {
  position: fixed;
  left: 50%;
  top: 45%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 9999;
  font-weight: 800;
  font-size: 1.2rem;
  letter-spacing: 0.04em;
  color: var(--accent);
  text-shadow: 0 0 12px rgba(45, 212, 191, 0.55);
  animation: fly67 2.4s ease-out forwards;
}
    
/* ===== PERSONALITY DISPLAY TWEAKS ===== */
.personality-sofia ~ #personalityWhisper {
  color: #ec4899;
  text-shadow: 0 0 8px rgba(168, 85, 247, 0.6);
}
@keyframes sofiaAura {
  0% {
    box-shadow:
      0 0 20px rgba(236, 72, 153, 0.6),
      0 0 40px rgba(236, 72, 153, 0.4);
    filter: saturate(1);
  }

  50% {
    box-shadow:
      0 0 30px rgba(168, 85, 247, 0.9),
      0 0 60px rgba(168, 85, 247, 0.7);
    filter: saturate(1.3);
  }

  100% {
    box-shadow:
      0 0 20px rgba(236, 72, 153, 0.6),
      0 0 40px rgba(236, 72, 153, 0.4);
    filter: saturate(1);
  }
}

.personality-sofia {
  animation: sofiaAura 3.8s ease-in-out infinite;
}
    
#personalityResult {
  cursor: default;
  user-select: text;
}
#personalityResult:not(.revealed) {
  filter: blur(4px);
  opacity: 0.6;
}

#personalityResult.revealed {
  filter: none;
  opacity: 1;
}
#panel-personality .card {
  background: linear-gradient(
    135deg,
    rgba(45, 212, 191, 0.12),
    rgba(2, 6, 23, 0.6)
  );
  min-height: 220px;
}
/* ===== PERSONALITY CARD EXPANSION ===== */
#panel-personality .card {
  min-height: 220px;
  max-width: 100%;
}

#personalityResult {
  font-size: 0.95rem;
  line-height: 1.5;
}
  </style>
</head>
<body>
<main>
  <header class="header-bar">
  <div>
    <h1>
      Accessible Braille Translator
      <span class="logo-dot">‚†É‚†ó‚†á</span>
    </h1>
    <p class="tagline">
      Type text, see Braille dots visually, and let screen readers ‚Äúfeel‚Äù each cell with spoken labels.
    </p>
  </div>

  <!-- TAB CONTROLS MOVED HERE -->
  <div class="tabs" role="tablist" aria-label="Braille translator tabs">
  <button
    class="tab-button"
    role="tab"
    id="tab-translator"
    aria-selected="true"
    aria-controls="panel-translator">
    Translator
  </button>

  <button
    class="tab-button"
    role="tab"
    id="tab-info"
    aria-selected="false"
    aria-controls="panel-info">
    Info
  </button>
    
  <button
  class="tab-button"
  role="tab"
  id="tab-personality"
  aria-selected="false"
  aria-controls="panel-personality">
  Personality
</button>
    
</div>
</header>

  <section class="grid" aria-label="Braille translator">
  <!-- =================== INFO TAB =================== -->
<div
  id="panel-info"
  class="tab-panel"
  role="tabpanel"
  aria-labelledby="tab-info"
  aria-hidden="true">

  <section class="card">
    <div class="output-header">
      <div class="output-title">Did you know?</div>
      <div class="output-subtitle">How numbers work in Braille</div>
    </div>

    <p class="hint" style="margin-top:0.4rem;">
      In English Braille, numbers don‚Äôt have their own unique symbols.
      Instead, Braille uses a <strong>number sign</strong> to signal that the
      following letters should be read as numbers.
    </p>

    <p class="hint">
      The number sign is <strong>‚†º</strong>. After it appears, the letters
      <strong>a‚Äìj</strong> represent the digits <strong>1‚Äì0</strong>.
      This number mode continues until a space or line break.
    </p>

    <p class="hint">
      Examples:
      <br />
      <strong>2025</strong> ‚Üí <strong>‚†º‚†É‚†ö‚†É‚†ë</strong>
      <br />
      <strong>Room 204</strong> ‚Üí <strong>‚†ó‚†ï‚†ï‚†ç ‚†º‚†É‚†ö‚†ô</strong>
    </p>
  </section>
  <section class="card" style="margin-top:1rem;">
  <div class="output-header">
    <div class="output-title">Did you know?</div>
    <div class="output-subtitle">How capitalization works in Braille</div>
  </div>

  <p class="hint" style="margin-top:0.4rem;">
    In English Braille, capital letters do not have different dot patterns
    from lowercase letters. Instead, Braille uses a <strong>capital sign</strong>
    to indicate that the following letter should be read as uppercase.
  </p>

  <p class="hint">
    The capital sign is <strong>‚††</strong> (dot&nbsp;6). It appears
    <em>before</em> the letter it modifies.
  </p>

  <p class="hint">
    Examples:
    <br />
    <strong>c</strong> ‚Üí <strong>‚†â</strong>
    <br />
    <strong>C</strong> ‚Üí <strong>‚††‚†â</strong>
    <br />
    <strong>Cat</strong> ‚Üí <strong>‚††‚†â‚†Å‚†û</strong>
  </p>

  <p class="hint">
    Screen readers will announce the capital sign so that users can clearly
    distinguish between uppercase and lowercase letters.
  </p>
</section>
</div>
<!-- =================== PERSONALITY TAB =================== -->
<div
  id="panel-personality"
  class="tab-panel"
  role="tabpanel"
  aria-labelledby="tab-personality"
  aria-hidden="true">

  <section class="card">
    <div class="output-header">
      <div class="output-title">‚ú® Your Braille Personality</div>
      <div class="output-subtitle">Not science. Pure vibes.</div>
    </div>

    <label for="personalityInput" class="hint">
  Enter your name to reveal your Braille personality
</label>

<input
  id="personalityInput"
  type="text"
  placeholder="Your name‚Ä¶"
  style="
    width:100%;
    padding:0.6rem 0.7rem;
    margin:0.4rem 0 0.6rem;
    border-radius:10px;
    border:1px solid rgba(148,163,184,0.4);
    background:#020617;
    color:var(--text);
  "
/>

<button
  id="revealPersonality"
  class="tab-button"
  style="margin-bottom:0.6rem;">
  Reveal ‚ú®
</button>
    
<button
  id="resetPersonality"
  class="tab-button"
  style="margin-left:0.4rem; opacity:0.7;">
  Try another name
</button>

<div id="personalityResult" class="hint">
  Your result will appear here.
</div>
    
<div
  id="personalityBrailleName"
  class="hint"
  style="margin-top:0.4rem; opacity:0.85;">
</div>
    
<div
  id="personalityWhisper"
  class="hint"
  aria-hidden="true"
  style="opacity:0; margin-top:0.6rem; font-style:italic;">
</div>
  </section>

</div>
    
    <!-- =================== TRANSLATOR TAB =================== -->
<div
  id="panel-translator"
  class="tab-panel"
  role="tabpanel"
  aria-labelledby="tab-translator"
  aria-hidden="false">
    

      <div class="translator-row">

  <!-- INPUT -->
  <section class="card" aria-label="Text input">
    <label for="sourceText">Text to translate</label>
    <p class="hint">
      Supports basic Grade&nbsp;1 English (letters a‚Äìz, space, . , ? !). Case is announced to screen readers.
    </p>
    <textarea
      id="sourceText"
      name="sourceText"
      autocomplete="off"
      spellcheck="false"
      placeholder="Type something like: Hello world!"
    ></textarea>
    <p class="footer-note">
      <span class="badge">
        <span class="badge-dot"></span>
        Screen-reader friendly: each Braille cell has an ARIA label like ‚Äúa, dots 1‚Äù.
      </span>
    </p>
  </section>

  <!-- OUTPUT -->
  <section class="card" aria-label="Braille output">
    <div class="output-header">
      <div class="output-title">Braille output</div>
      <div class="output-subtitle">
        Screen readers will read each cell by name and dot pattern.
      </div>
    </div>

    <div id="brailleOutput"
      class="output-box"
      aria-live="polite"
      aria-label="Braille translation output"
      contenteditable="true"
      role="textbox"
      spellcheck="false">
      <p class="hint" style="margin:0;">
        Your Braille translation will appear here as you type.
      </p>
    </div>

    <div id="braillePlainText" class="sr-only"
      aria-hidden="false"
      aria-label="Plain text representation of the Braille dots"></div>
  </section>

</div>
  <!-- ============ ADDED: TOUCH-ONLY LETTER KEYBOARD (A‚ÄìZ, . ! ?, SPACE) ============ -->
  <section class="card" aria-hidden="true" style="margin-top:1rem;">
    <p class="hint" style="margin-bottom:0.6rem;">
      Touch the keys below to insert letters. This keyboard is hidden from screen readers.
    </p>
    <div id="brailleKeyboard" class="braille-keyboard"></div>
  </section>
  </div> <!-- end panel-translator -->
  </section>


  <p class="footer-note">
    Note: This is a simplified visual and auditory helper for Braille patterns, not a full production-grade Braille translation engine.
  </p>
</main>

<script>
  // Basic Grade 1 Braille map (letters + some punctuation)
  const brailleMap = {
    'a': '‚†Å', // dots 1
    'b': '‚†É', // 1 2
    'c': '‚†â', // 1 4
    'd': '‚†ô', // 1 4 5
    'e': '‚†ë', // 1 5
    'f': '‚†ã', // 1 2 4
    'g': '‚†õ', // 1 2 4 5
    'h': '‚†ì', // 1 2 5
    'i': '‚†ä', // 2 4
    'j': '‚†ö', // 2 4 5
    'k': '‚†Ö', // 1 3
    'l': '‚†á', // 1 2 3
    'm': '‚†ç', // 1 3 4
    'n': '‚†ù', // 1 3 4 5
    'o': '‚†ï', // 1 3 5
    'p': '‚†è', // 1 2 3 4
    'q': '‚†ü', // 1 2 3 4 5
    'r': '‚†ó', // 1 2 3 5
    's': '‚†é', // 2 3 4
    't': '‚†û', // 2 3 4 5
    'u': '‚†•', // 1 3 6
    'v': '‚†ß', // 1 2 3 6
    'w': '‚†∫', // 2 4 5 6
    'x': '‚†≠', // 1 3 4 6
    'y': '‚†Ω', // 1 3 4 5 6
    'z': '‚†µ', // 1 3 5 6
    ' ': ' ',  // space
    '.': '‚†≤',  // 2 5 6
    ',': '‚†Ç',  // 2
    '?': '‚†¶',  // 2 3 6
    '!': '‚†ñ'   // 2 3 5
  };
    // Braille number system (Grade 1 English)
  const NUMBER_SIGN = '‚†º';
  const CAPITAL_SIGN = '‚††'; // dot 6

  const digitToBraille = {
    '1': '‚†Å',
    '2': '‚†É',
    '3': '‚†â',
    '4': '‚†ô',
    '5': '‚†ë',
    '6': '‚†ã',
    '7': '‚†õ',
    '8': '‚†ì',
    '9': '‚†ä',
    '0': '‚†ö'
  };

  const brailleLabels = {
    'a': 'a, dots 1',
    'b': 'b, dots 1 2',
    'c': 'c, dots 1 4',
    'd': 'd, dots 1 4 5',
    'e': 'e, dots 1 5',
    'f': 'f, dots 1 2 4',
    'g': 'g, dots 1 2 4 5',
    'h': 'h, dots 1 2 5',
    'i': 'i, dots 2 4',
    'j': 'j, dots 2 4 5',
    'k': 'k, dots 1 3',
    'l': 'l, dots 1 2 3',
    'm': 'm, dots 1 3 4',
    'n': 'n, dots 1 3 4 5',
    'o': 'o, dots 1 3 5',
    'p': 'p, dots 1 2 3 4',
    'q': 'q, dots 1 2 3 4 5',
    'r': 'r, dots 1 2 3 5',
    's': 's, dots 2 3 4',
    't': 't, dots 2 3 4 5',
    'u': 'u, dots 1 3 6',
    'v': 'v, dots 1 2 3 6',
    'w': 'w, dots 2 4 5 6',
    'x': 'x, dots 1 3 4 6',
    'y': 'y, dots 1 3 4 5 6',
    'z': 'z, dots 1 3 5 6',
    ' ': 'space',
    '.': 'period, dots 2 5 6',
    ',': 'comma, dots 2',
    '?': 'question mark, dots 2 3 6',
    '!': 'exclamation mark, dots 2 3 5'
  };
    const digitLabels = {
    '1': 'number 1',
    '2': 'number 2',
    '3': 'number 3',
    '4': 'number 4',
    '5': 'number 5',
    '6': 'number 6',
    '7': 'number 7',
    '8': 'number 8',
    '9': 'number 9',
    '0': 'number 0'
  };

  const input = document.getElementById('sourceText');
  const output = document.getElementById('brailleOutput');
  const plain = document.getElementById('braillePlainText');
// PREVENT NATIVE TEXT INSERTION INTO BRAILLE OUTPUT
output.addEventListener('beforeinput', (e) => {
  e.preventDefault();
});
// ALLOW KEYBOARD TYPING INTO BRAILLE CONSOLE (CONTROLLED)
output.addEventListener('keydown', (e) => {
  // Allow navigation keys
  const allowedControlKeys = [
    'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
    'Tab', 'Shift', 'Control', 'Alt', 'Meta'
  ];
  if (allowedControlKeys.includes(e.key)) return;

  e.preventDefault();

  // Handle backspace
  if (e.key === 'Backspace') {
    input.value = input.value.slice(0, -1);
    translateToBraille(input.value);
    return;
  }

  // Handle enter (newline)
  if (e.key === 'Enter') {
    input.value += '\n';
    translateToBraille(input.value);
    return;
  }

  // Handle printable characters
  if (e.key.length === 1) {
    input.value += e.key;
    translateToBraille(input.value);
  }
});
  function translateToBraille(text) {
    // Build both DOM spans (for visual + screen reader) and plain text string.
    output.innerHTML = '';
    let plainResult = '';

    if (!text.trim()) {
      const p = document.createElement('p');
      p.className = 'hint';
      p.textContent = 'Your Braille translation will appear here as you type.';
      output.appendChild(p);
      plain.textContent = '';
      return;
    }

    const lines = text.split(/\r?\n/);

    lines.forEach((line, lineIndex) => {
      let inNumberMode = false;
      const lineDiv = document.createElement('div');
      lineDiv.className = 'braille-line';

      for (let i = 0; i < line.length; i++) {
        const charOriginal = line[i];
        const lower = charOriginal.toLowerCase();
        const isLetter = /[a-z]/.test(lower);
        const isUpper = isLetter && charOriginal !== lower;

        let brailleChar;
        let label;

        // ===== NUMBER HANDLING =====
        if (/[0-9]/.test(charOriginal)) {
          if (!inNumberMode) {
            // Insert number sign ‚†º
            const numSignSpan = document.createElement('span');
            numSignSpan.className = 'braille-cell';
            numSignSpan.textContent = NUMBER_SIGN;
            numSignSpan.setAttribute('aria-label', 'number sign');
            lineDiv.appendChild(numSignSpan);
            plainResult += NUMBER_SIGN;
            inNumberMode = true;
          }

          brailleChar = digitToBraille[charOriginal];
          label = digitLabels[charOriginal];
        } else {
          inNumberMode = false;
          brailleChar = brailleMap[lower];
          label = brailleLabels[lower];
        }

        if (typeof brailleChar === 'undefined') {
          // Fallback: keep the character as-is
          brailleChar = charOriginal;
          label = `character ${charOriginal}`;
        }

        // ===== CAPITAL LETTER HANDLING =====
if (isUpper) {
  // Insert capital sign BEFORE the letter
  const capSpan = document.createElement('span');
  capSpan.className = 'braille-cell';
  capSpan.textContent = CAPITAL_SIGN;
  capSpan.setAttribute('aria-label', 'capital sign');

  lineDiv.appendChild(capSpan);
  plainResult += CAPITAL_SIGN;

  // Update label for the actual letter
  label = `capital ${lower}, ${brailleLabels[lower] || 'letter'}`;
}

        const span = document.createElement('span');
        span.className = 'braille-cell' + (lower === ' ' ? ' space' : '');
        span.textContent = brailleChar;
        span.setAttribute('aria-label', label);

        lineDiv.appendChild(span);
        plainResult += brailleChar;
      }

      output.appendChild(lineDiv);

      if (lineIndex < lines.length - 1) {
        plainResult += '\n';
      }
    });
  }
  input.addEventListener('input', () => {
    translateToBraille(input.value);
  });

  // Initial state
  translateToBraille('');

  // =============== ADDED: BUILD TOUCH LETTER KEYBOARD (A‚ÄìZ, . ! ?, SPACE) ===============
  const keyboardContainer = document.getElementById('brailleKeyboard');
  const keyChars = 'abcdefghijklmnopqrstuvwxyz0123456789.!? ';

  keyChars.split('').forEach(char => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'braille-key' + (char === ' ' ? ' space-key' : '');
    btn.dataset.char = char;
    btn.textContent =
      char === ' '
        ? 'Space'
        : /[0-9]/.test(char)
            ? char
            : char.toUpperCase();
    btn.setAttribute('tabindex', '-1'); // keep out of keyboard tab order
    keyboardContainer.appendChild(btn);
  });

  // Use pointer events so it works for touch + mouse, but still only discoverable by touch
  keyboardContainer.addEventListener('pointerdown', (event) => {
    const target = event.target;
    if (!target.classList.contains('braille-key')) return;
    event.preventDefault();

    const ch = target.dataset.char;
    if (!ch) return;

    // Append to the source text and re-translate
    input.value += ch;
    translateToBraille(input.value);
  });
  // ======================================================================
// ====================== BRAILLE ‚Üí ENGLISH SUPPORT =====================
// ======================================================================

// Build reverse braille lookup map
const reverseBrailleMap = Object.fromEntries(
  Object.entries(brailleMap).map(([k, v]) => [v, k])
);

// Convert braille unicode back to English text
function translateFromBraille(brailleText) {
  let english = '';

  for (const ch of brailleText) {
    if (ch === ' ') {
      english += ' ';
    } else {
      english += reverseBrailleMap[ch] ?? ch;
    }
  }

  return english;
}

// Listen for typing INSIDE the braille output box
output.addEventListener('input', () => {

  const typedBraille = output.textContent;

  // Convert braille ‚Üí English
  const english = translateFromBraille(typedBraille);

  // Put English back into the textarea
  input.value = english;

  // Re-render braille with clean cells + accessibility labels
  translateToBraille(english);

});
// =================== TAB SWITCHING ===================
const tabs = document.querySelectorAll('[role="tab"]');
const panels = document.querySelectorAll('[role="tabpanel"]');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
    panels.forEach(p => p.setAttribute('aria-hidden', 'true'));

    tab.setAttribute('aria-selected', 'true');
    document
      .getElementById(tab.getAttribute('aria-controls'))
      .setAttribute('aria-hidden', 'false');
  });
});
  // =================== BRAILLE PERSONALITY ENGINE ===================
function applyTierAccent(type) {
  const root = document.documentElement;

  const colors = {
    common: '#22c55e',
    uncommon: '#3b82f6',
    rare: '#a855f7',
    legendary: '#facc15',
    oracle: '#e5e7eb',
    sofia: '#ec4899'
  };

  const color = colors[type] || '#2dd4bf';

  root.style.setProperty('--accent', color);
  root.style.setProperty('--accent-soft', `${color}26`);
}
// =================== BRAILLE PERSONALITY ENGINE (DETERMINISTIC) ===================

// Simple deterministic hash
function hashText(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = (hash << 5) - hash + str.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash);
}

function analyzeBraillePersonality(text) {
  if (!text || text.trim().length < 3) return null;

  const trimmed = text.trim();
  const lower = trimmed.toLowerCase();

  // üåü CREATOR SIGNATURE
  if (lower === 'sofia tang') {
    return { type: 'sofia', variant: 0 };
  }

  // üï∂Ô∏è ORACLE
  if (lower.includes('braille')) {
    return { type: 'oracle', variant: 0 };
  }

  const words = trimmed.split(/\s+/).filter(Boolean);
  const length = trimmed.length;
  const hasCaps = /[A-Z]/.test(trimmed);
  const hasPunct = /[.!?]/.test(trimmed);

  const hash = hashText(trimmed);
  const variant = hash % 6;

  // initials like "S T" or "S.T." or "S. T."
  const initialsLike = /^[A-Za-z]\.?\s*[A-Za-z]\.?$/.test(trimmed);

  // üü° LEGENDARY: first + last OR initials
  if (words.length >= 2 || initialsLike) {
    return { type: 'legendary', variant };
  }

  // üü£ RARE: longer single name or punctuation
  if (length >= 7 || hasPunct) {
    return { type: 'rare', variant };
  }

  // üîµ UNCOMMON: medium length or any caps
  if (length >= 5 || hasCaps) {
    return { type: 'uncommon', variant };
  }

  // üü¢ COMMON: short, lowercase, single word
  return { type: 'common', variant };
}

function generatePersonalityText(result) {
  const { type, variant } = result;

  const personalities = {
    common: [
  `üü¢ <strong>The Grounded Translator</strong><br>
   You value clarity and calm. Your Braille is steady, readable, and trustworthy.<br>
   <em>Vibe:</em> quiet reliability.`,

  `üü¢ <strong>The Consistent Reader</strong><br>
   You favor balance and predictability. Your dots feel intentional and stable.<br>
   <em>Vibe:</em> dependable presence.`,

  `üü¢ <strong>The Careful Communicator</strong><br>
   You think before you type. Nothing feels rushed or careless in your text.<br>
   <em>Vibe:</em> thoughtful calm.`,

  `üü¢ <strong>The Minimalist</strong><br>
   You don‚Äôt overcomplicate language. Your Braille is clean and efficient.<br>
   <em>Vibe:</em> clarity-first energy.`,

  `üü¢ <strong>The Listener</strong><br>
   You translate with empathy. Your words feel chosen for someone, not everyone.<br>
   <em>Vibe:</em> grounded understanding.`,

  `üü¢ <strong>The Steady Hand</strong><br>
   You bring order to text. Even complex ideas feel approachable.<br>
   <em>Vibe:</em> quiet competence.`
],

    uncommon: [
  `üîµ <strong>The Pattern Seer</strong><br>
   You notice structure others miss. Your Braille reflects logic and order.<br>
   <em>Vibe:</em> analytical calm.`,

  `üîµ <strong>The Intentional Typist</strong><br>
   Every character has purpose. Your writing feels pre-edited.<br>
   <em>Vibe:</em> precision mindset.`,

  `üîµ <strong>The Strategist</strong><br>
   You plan your language like moves on a board.<br>
   <em>Vibe:</em> controlled foresight.`,

  `üîµ <strong>The System Thinker</strong><br>
   You enjoy consistency and internal rules in language.<br>
   <em>Vibe:</em> quiet optimization.`,

  `üîµ <strong>The Organizer</strong><br>
   Your text feels sorted and intentional, even when casual.<br>
   <em>Vibe:</em> structured clarity.`,

  `üîµ <strong>The Precision Reader</strong><br>
   You value accuracy over speed. Your dots rarely feel accidental.<br>
   <em>Vibe:</em> thoughtful exactness.`
],
    rare: [
  `üü£ <strong>The Expressive Architect</strong><br>
   You balance emotion and structure seamlessly.<br>
   <em>Vibe:</em> creative discipline.`,

  `üü£ <strong>The Storyweaver</strong><br>
   Your Braille feels narrative and alive.<br>
   <em>Vibe:</em> late-night creator.`,

  `üü£ <strong>The Signal Booster</strong><br>
   Your words carry weight. People feel your intent.<br>
   <em>Vibe:</em> expressive impact.`,

  `üü£ <strong>The Aesthetic Translator</strong><br>
   You care how language feels, not just what it says.<br>
   <em>Vibe:</em> intentional beauty.`,

  `üü£ <strong>The Emotional Cartographer</strong><br>
   You map feeling through dots and spacing.<br>
   <em>Vibe:</em> subtle intensity.`,

  `üü£ <strong>The Creative Analyst</strong><br>
   You mix logic with flair effortlessly.<br>
   <em>Vibe:</em> controlled creativity.`
],

legendary: [
  `üü° <strong>The Braille Virtuoso</strong><br>
   You move fluently between precision and expression.<br>
   <em>Vibe:</em> effortless mastery.`,

  `üü° <strong>The Dot Alchemist</strong><br>
   You transform raw text into experience.<br>
   <em>Vibe:</em> art meets logic.`,

  `üü° <strong>The Luminary</strong><br>
   Others unconsciously follow your structure.<br>
   <em>Vibe:</em> quiet authority.`,

  `üü° <strong>The Pattern Leader</strong><br>
   Your writing sets standards without trying.<br>
   <em>Vibe:</em> influential calm.`,

  `üü° <strong>The Braille Conductor</strong><br>
   You orchestrate language with precision and flow.<br>
   <em>Vibe:</em> composed brilliance.`,

  `üü° <strong>The Master Translator</strong><br>
   Your Braille feels inevitable, like it couldn‚Äôt be otherwise.<br>
   <em>Vibe:</em> refined excellence.`
],

    oracle: [
  `üï∂Ô∏è <strong>The Braille Oracle</strong><br>
   You typed the name of the system itself.<br>
   The dots recognized you.<br><br>
   <em>‚ÄúNot all readers are meant to translate.‚Äù</em>`
],

    sofia: [
  `‚ú® <strong>The Architect of the System</strong><br>
   You built a space where Braille is easy to read and use.<br>
   Accessibility here is intentional, expressive, and human.<br><br>
   <em>Vibe:</em> thoughtful creator energy.`
]
  };

  return personalities[type][variant] || personalities.common[0];
}
function showWhisper(type) {
  const whisper = document.getElementById('personalityWhisper');
  if (!whisper) return;

  const whispers = {
    rare: 'You unlocked a rare type.',
    legendary: 'Few users reach this.',
    oracle: 'The system noticed you.'
  };

  if (!whispers[type]) {
    whisper.style.opacity = 0;
    whisper.setAttribute('aria-hidden', 'true');
    return;
  }

  whisper.textContent = whispers[type];
  whisper.style.opacity = 1;
  whisper.setAttribute('aria-hidden', 'false');
}
const personalityInput = document.getElementById('personalityInput');
const revealBtn = document.getElementById('revealPersonality');
const resetBtn = document.getElementById('resetPersonality');

resetBtn?.addEventListener('click', () => {
  if (personalityInput) personalityInput.value = '';

  const box = document.getElementById('personalityResult');
  if (box) {
    box.className = 'hint';
    box.classList.remove(
      'revealed',
      'personality-rare',
      'personality-legendary',
      'personality-oracle',
      'personality-sofia'
    );
    box.innerHTML = 'Your result will appear here.';
  }

  // reset accent to default teal
  document.documentElement.style.setProperty('--accent', '#2dd4bf');
  document.documentElement.style.setProperty('--accent-soft', 'rgba(45, 212, 191, 0.16)');

  const nameBox = document.getElementById('personalityBrailleName');
  if (nameBox) nameBox.innerHTML = '';

  const whisper = document.getElementById('personalityWhisper');
  if (whisper) {
    whisper.textContent = '';
    whisper.style.opacity = 0;
    whisper.setAttribute('aria-hidden', 'true');
  }

  personalityInput?.focus();
});

function spawnFlying67(count = 14) {
  for (let i = 0; i < count; i++) {
    const el = document.createElement('div');
    el.className = 'flying-67';
    el.textContent = '67';

    // random start/end offsets
    const x0 = (Math.random() * 80 - 40) + 'vw';
    const y0 = (Math.random() * 40 - 20) + 'vh';
    const x1 = (Math.random() * 160 - 80) + 'vw';
    const y1 = (Math.random() * 120 - 60) + 'vh';

    el.style.setProperty('--x0', x0);
    el.style.setProperty('--y0', y0);
    el.style.setProperty('--x1', x1);
    el.style.setProperty('--y1', y1);

    // stagger
    el.style.animationDelay = (Math.random() * 0.35) + 's';

    document.body.appendChild(el);

    // cleanup after animation
    setTimeout(() => el.remove(), 3200);
  }
}

  
function textToBrailleInline(text) {
  let result = '';
  let inNumberMode = false;

  for (const char of text) {
    const lower = char.toLowerCase();

    if (/[0-9]/.test(char)) {
      if (!inNumberMode) {
        result += NUMBER_SIGN;
        inNumberMode = true;
      }
      result += digitToBraille[char] || '';
      continue;
    }

    inNumberMode = false;

    if (/[a-z]/.test(lower)) {
      if (char !== lower) {
        result += CAPITAL_SIGN;
      }
      result += brailleMap[lower] || '';
    }
  }

  return result;
}
    
function runPersonalityReveal(text) {
  const personalityBox = document.getElementById('personalityResult');
  if (!personalityBox) return;

  const trimmed = (text || '').trim();

  // ‚úÖ show message if too short
  if (trimmed.length < 3) {
    personalityBox.className = 'hint';
    personalityBox.classList.remove(
      'revealed',
      'personality-rare',
      'personality-legendary',
      'personality-oracle',
      'personality-sofia'
    );
    personalityBox.innerHTML =
      'Type at least <strong>3 characters</strong> to reveal your Braille personality ‚ú®';

    // optional polish: clear name + whisper + reset accent
    const nameBox = document.getElementById('personalityBrailleName');
    if (nameBox) nameBox.innerHTML = '';

    const whisper = document.getElementById('personalityWhisper');
    if (whisper) {
      whisper.textContent = '';
      whisper.style.opacity = 0;
      whisper.setAttribute('aria-hidden', 'true');
    }

    document.documentElement.style.setProperty('--accent', '#2dd4bf');
    document.documentElement.style.setProperty('--accent-soft', 'rgba(45, 212, 191, 0.16)');
    return;
  }

  const cleaned = trimmed.toLowerCase();
  const result = analyzeBraillePersonality(trimmed);
  if (!result) return;

  applyTierAccent(result.type);

  // reset classes + state
  personalityBox.className = 'hint';
  personalityBox.classList.remove(
    'revealed',
    'personality-rare',
    'personality-legendary',
    'personality-oracle',
    'personality-sofia'
  );

  // ===== EASTER EGG #1: Alicia Lu ‚Üí "tellurium" first =====
  const telluriumPrefix =
    cleaned === 'alicia lu'
      ? `<div style="margin-bottom:0.35rem;"><strong>Tellurium</strong></div>`
      : '';

  // Normal personality (always happens)
  personalityBox.innerHTML = telluriumPrefix + generatePersonalityText(result);

  // ===== EASTER EGG #2: Shayla Bergen ‚Üí flying 67 =====
  if (cleaned === 'shayla bergen') {
    spawnFlying67(18);
  }

  // Braille name line (always happens)
  const brailleNameBox = document.getElementById('personalityBrailleName');
  if (brailleNameBox) {
    brailleNameBox.innerHTML =
      `<strong>Your name in Braille:</strong> ${textToBrailleInline(text)}`;
  }

  // reveal + tier glow classes
  personalityBox.classList.add('revealed');

  if (result.type === 'rare') personalityBox.classList.add('personality-rare');
  if (result.type === 'legendary') personalityBox.classList.add('personality-legendary');
  if (result.type === 'oracle') personalityBox.classList.add('personality-oracle');
  if (result.type === 'sofia') personalityBox.classList.add('personality-sofia');

  showWhisper(result.type);
}

// Button click
revealBtn?.addEventListener('click', () => {
  runPersonalityReveal(personalityInput.value);
});

// Enter key support
personalityInput?.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    runPersonalityReveal(personalityInput.value);
  }
});
</script>
</body>
</html>

